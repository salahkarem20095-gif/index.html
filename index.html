<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Legendary Falling Balls Game</title>
<style>
body { margin:0; padding:0; font-family:Arial; background:#87CEEB; text-align:center; }
canvas { display:block; margin:0 auto; border:3px solid black; }
#startScreen, #settingsScreen, #colorScreen, #levelScreen, #gameOverScreen {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); color:white; display:flex;
    flex-direction:column; justify-content:center; align-items:center;
    font-size:30px; z-index:10;
}
.hidden { display:none; }
button { font-size:18px; padding:10px 20px; margin:5px; cursor:pointer; }
.colorBtn { width:50px; height:50px; margin:5px; border:none; cursor:pointer; }
#scoreBox { font-size:20px; background:white; padding:5px; border:2px solid black; }
#shop { background:white; border:2px solid black; padding:5px; font-size:18px; }
</style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
<div id="startScreen">
    <h1>ğŸ”¥ LEGENDARY MODE ğŸ”¥</h1>
    <button id="startBtn">Ø§Ø¨Ø¯Ø£</button>
    <button id="settingsBtn">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <button id="colorBtnScreen">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settingsScreen" class="hidden">
    <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
    <button id="mouseControlBtn">ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø§ÙˆØ³</button>
    <button id="touchControlBtn">ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³</button>
    <button id="settingsConfirmBtn" class="hidden">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙƒÙ…</button>
    <button id="backBtn">Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù† -->
<div id="colorScreen" class="hidden">
    <h2>ğŸ›’ Ø§Ø®ØªØ± Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙƒØ±Ø§Øª</h2>
    <div id="colorOptions">
        <button class="colorBtn" style="background:green;" data-color="green"></button>
        <button class="colorBtn" style="background:red;" data-color="red"></button>
        <button class="colorBtn" style="background:black;" data-color="black"></button>
        <button class="colorBtn" style="background:white;" data-color="white"></button>
        <button class="colorBtn" style="background:purple;" data-color="purple"></button>
    </div>
    <button id="colorConfirmBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
<div id="levelScreen" class="hidden">
    <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h2>
    <button class="levelBtn" data-level="easy">Ø³Ù‡Ù„</button>
    <button class="levelBtn" data-level="normal">Ø¹Ø§Ø¯ÙŠ</button>
    <button class="levelBtn" data-level="hard">ØµØ¹Ø¨</button>
</div>

<!-- Ø´Ø§Ø´Ø© Game Over -->
<div id="gameOverScreen" class="hidden">
    <h2>Game Over</h2>
    <p id="finalScore"></p>
    <p id="highScoreDisplay"></p>
    <button id="restartBtn">Restart</button>
</div>

<!-- Score & Shop -->
<div id="scoreBox">
Score: <span id="score">0</span> |
Coins: <span id="coins">0</span> |
Lives: <span id="lives">3</span> |
Level: <span id="level">1</span> |
Speed: <span id="speed">0</span> |
High Score: <span id="highScore">0</span>
</div>

<button id="pauseBtn">â¸ Ø¥ÙŠÙ‚Ø§Ù</button>
<button id="turboBtn">ğŸ”¥ Turbo Mode</button>
<button id="extraBtn">âœ¨ Extra</button>

<div id="shop">
<h3>ğŸ›’ Shop</h3>
<button id="buySlow35">ğŸ¢ Slow Time (35 Coins)</button>
<button id="firePower">ğŸ”¥ Fire Strike (50 Coins)</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ========== Ù…ØªØºÙŠØ±Ø§Øª ==========
let balls=[], score=0, coins=0, level=1, lives=3;
let gameRunning=false, isPaused=false, turbo=false;
let hits=0, highScore = localStorage.getItem("legendHighScore") || 0;
document.getElementById("highScore").textContent=highScore;
let fireUsed=false, controlMode='touch', selectedColors=[];

// ========== Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ==========
document.getElementById("startBtn").onclick = ()=> {
    document.getElementById("startScreen").classList.add("hidden");
    document.getElementById("levelScreen").classList.remove("hidden");
};
document.getElementById("settingsBtn").onclick = ()=>{
    document.getElementById("startScreen").classList.add("hidden");
    document.getElementById("settingsScreen").classList.remove("hidden");
};
document.getElementById("colorBtnScreen").onclick = ()=>{
    document.getElementById("startScreen").classList.add("hidden");
    document.getElementById("colorScreen").classList.remove("hidden");
};
document.getElementById("backBtn").onclick = ()=>{
    document.getElementById("settingsScreen").classList.add("hidden");
    document.getElementById("startScreen").classList.remove("hidden");
};
document.getElementById("mouseControlBtn").onclick = ()=>{
    controlMode='mouse';
    document.getElementById("settingsConfirmBtn").classList.remove("hidden");
};
document.getElementById("touchControlBtn").onclick = ()=>{
    controlMode='touch';
    document.getElementById("settingsConfirmBtn").classList.remove("hidden");
};
document.getElementById("settingsConfirmBtn").onclick = ()=>{
    document.getElementById("settingsScreen").classList.add("hidden");
    document.getElementById("levelScreen").classList.remove("hidden");
};

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù†
document.querySelectorAll(".colorBtn").forEach(btn=>{
    btn.onclick = ()=>{
        let color = btn.dataset.color;
        if(!selectedColors.includes(color)) selectedColors.push(color);
        btn.style.border="3px solid gold";
    };
});
document.getElementById("colorConfirmBtn").onclick = ()=>{
    if(selectedColors.length===0) alert("Ø§Ø®ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„ÙˆÙ† ÙˆØ§Ø­Ø¯!");
    else{
        document.getElementById("colorScreen").classList.add("hidden");
        document.getElementById("levelScreen").classList.remove("hidden");
    }
};

// ========== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù†ÙØ³ ==========
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ========== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© ==========
function randomColor(){ 
    if(selectedColors.length>0) return selectedColors[Math.floor(Math.random()*selectedColors.length)];
    let c=["red","green","blue","yellow","purple","orange"]; 
    return c[Math.floor(Math.random()*c.length)];
}

function createBall(explosive=false){
    return {x:Math.random()*(canvas.width-40)+20, y:Math.random()*-200, r:30,
            speed:3, color:explosive?"black":randomColor(), explosive, flash:false, dx:Math.random()*2-1};
}

function initBalls(){
    balls=[]; for(let i=0;i<5;i++) balls.push(createBall()); balls.push(createBall(true));
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    balls.forEach(b=>{
        ctx.beginPath();
        ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
        ctx.fillStyle=b.color; ctx.fill();
    });
}

function update(){
    if(!gameRunning || isPaused) return;
    let maxSpeed=0;
    balls.forEach(b=>{
        b.y+=b.speed; b.x+=b.dx*1.5;
        if(b.speed>maxSpeed) maxSpeed=b.speed;
        if(b.x-b.r<0||b.x+b.r>canvas.width) b.dx*=-1;
        if(b.y-b.r>canvas.height){
            if(!b.explosive){ score--; document.getElementById("score").textContent=score; }
            b.y=Math.random()*-200; b.x=Math.random()*(canvas.width-40)+20;
        }
    });
    document.getElementById("speed").textContent=maxSpeed.toFixed(1);
    draw();
    requestAnimationFrame(update);
}

function handleClick(x,y){
    balls.forEach(b=>{
        let dx=x-b.x, dy=y-b.y;
        if(dx*dx+dy*dy<=b.r*b.r){
            if(b.explosive){ lives--; if(lives<0) lives=0; document.getElementById("lives").textContent=lives; if(lives<=0) gameOver(); }
            else{ score++; coins++; hits++; document.getElementById("score").textContent=score; document.getElementById("coins").textContent=coins; b.y=Math.random()*-200; b.x=Math.random()*(canvas.width-40)+20; }
        }
    });
}

// ====== Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø§ÙˆØ³ ÙˆØ§Ù„Ù„Ù…Ø³ ======
canvas.addEventListener('mousedown', e=>{ if(controlMode==='mouse') handleClick(e.clientX,e.clientY); });
canvas.addEventListener('touchstart', e=>{
    if(controlMode==='touch'){ e.preventDefault(); const touch=e.touches[0]; handleClick(touch.clientX,touch.clientY); }
});

// ========== Game Over ==========
function gameOver(){
    gameRunning=false;
    document.getElementById("finalScore").textContent="Score: "+score;
    if(score>highScore){ highScore=score; localStorage.setItem("legendHighScore",highScore);}
    document.getElementById("highScoreDisplay").textContent="High Score: "+highScore;
    document.getElementById("gameOverScreen").classList.remove("hidden");
}
document.getElementById("restartBtn").onclick=()=>{
    document.getElementById("gameOverScreen").classList.add("hidden");
    document.getElementById("startScreen").classList.remove("hidden");
};

// ========== Level Select ==========
document.querySelectorAll(".levelBtn").forEach(btn=>{
    btn.onclick=()=>{
        level=btn.dataset.level==="easy"?1:btn.dataset.level==="normal"?2:3;
        document.getElementById("levelScreen").classList.add("hidden");
        startGame();
    };
});

function startGame(){
    score=0; coins=0; lives=3; hits=0;
    document.getElementById("score").textContent=score;
    document.getElementById("coins").textContent=coins;
    document.getElementById("lives").textContent=lives;
    document.getElementById("level").textContent=level;
    initBalls();
    gameRunning=true; update();
}

// ========= Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© ==========
document.getElementById("pauseBtn").onclick=()=>{
    isPaused=!isPaused;
    document.getElementById("pauseBtn").textContent=isPaused?"â–¶ ØªØ´ØºÙŠÙ„":"â¸ Ø¥ÙŠÙ‚Ø§Ù";
    if(!isPaused) update();
};
document.getElementById("extraBtn").onclick=()=>{
    balls.forEach(b=>{ if(!b.explosive) b.color=randomColor(); });
    alert("âœ¨ Extra Ball Colors Activated!");
};
document.getElementById("turboBtn").onclick=()=>{
    balls.forEach(b=> b.speed+=5);
    setTimeout(()=>{ balls.forEach(b=> b.speed-=5); },2000);
};
document.getElementById("buySlow35").onclick=()=>{
    if(coins>=35){ coins-=35; document.getElementById("coins").textContent=coins; balls.forEach(b=>b.speed=1); setTimeout(()=>{ balls.forEach(b=>b.speed=3); },3000); }
    else alert("Not enough coins!");
};
document.getElementById("firePower").onclick=()=>{
    if(fireUsed){ alert("ğŸ”¥ Fire Strike already used!"); return; }
    if(coins>=50){
        coins-=50; document.getElementById("coins").textContent=coins; fireUsed=true;
        let fireDuration=5000;
        let fireInterval=setInterval(()=>{
            balls.forEach(b=>{
                if(!b.explosive){ score++; coins++; document.getElementById("score").textContent=score; document.getElementById("coins").textContent=coins; b.y=Math.random()*-200; b.x=Math.random()*(canvas.width-40)+20; }
            });
        },100);
        setTimeout(()=> clearInterval(fireInterval), fireDuration);
        alert("ğŸ”¥ Fire Strike Activated for 5s!");
    } else alert("Not enough coins!");
};

</script>
</body>
</html>
