<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Legendary Tap Balls</title>
<style>
  body, html {
    margin:0; padding:0; height:100%; width:100%;
    font-family: Arial; background:#222; color:white; overflow:hidden;
  }
  #menu, #levelMenu, #settingsMenu, #shopMenu {
    position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
    text-align:center; display:flex; flex-direction:column; gap:15px;
  }
  button {
    font-size:20px; padding:10px 20px; cursor:pointer; border:none; border-radius:8px;
    background:gold; color:#222;
  }
  canvas { background:black; display:block; margin:auto; }
  .hidden { display:none; }
</style>
</head>
<body>

<!-- شاشة البداية -->
<div id="menu">
  <button id="startBtn">ابدأ</button>
  <button id="soundBtn">الصوت</button>
  <button id="shopBtn">سلة شراء</button>
  <button id="settingsBtn">إعدادات</button>
</div>

<!-- اختيار المستوى -->
<div id="levelMenu" class="hidden">
  <button class="levelBtn" data-speed="2">سهل</button>
  <button class="levelBtn" data-speed="4">عادي</button>
  <button class="levelBtn" data-speed="6">صعب</button>
</div>

<!-- إعدادات -->
<div id="settingsMenu" class="hidden">
  <button id="controlMobileBtn">تحكم الموبايل</button>
  <button id="controlPCBtn">تحكم الكمبيوتر</button>
</div>

<!-- سلة شراء -->
<div id="shopMenu" class="hidden">
  <button class="ballColorBtn" data-color="green">أخضر</button>
  <button class="ballColorBtn" data-color="red">أحمر</button>
  <button class="ballColorBtn" data-color="black">أسود</button>
  <button class="ballColorBtn" data-color="white">أبيض</button>
  <button class="ballColorBtn" data-color="purple">بنفسجي</button>
</div>

<!-- الكانفاس -->
<canvas id="gameCanvas" class="hidden"></canvas>

<script>
const menu = document.getElementById('menu');
const levelMenu = document.getElementById('levelMenu');
const settingsMenu = document.getElementById('settingsMenu');
const shopMenu = document.getElementById('shopMenu');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let balls = [];
let ballColor = 'green';
let ballSpeed = 2;
let score = 0;
let lives = 3;
let control = 'mobile'; // أو 'pc'

// تغيير حجم الكانفاس على حسب الشاشة
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);

// ** شاشة البداية **
document.getElementById('startBtn').onclick = () => { 
  menu.classList.add('hidden');
  levelMenu.classList.remove('hidden');
};
document.getElementById('soundBtn').onclick = () => alert('هنا تضبط الصوت (مؤقت)');
document.getElementById('settingsBtn').onclick = () => {
  menu.classList.add('hidden');
  settingsMenu.classList.remove('hidden');
};
document.getElementById('shopBtn').onclick = () => {
  menu.classList.add('hidden');
  shopMenu.classList.remove('hidden');
};

// التحكم
document.getElementById('controlMobileBtn').onclick = () => { control='mobile'; alert('تم اختيار تحكم الموبايل'); };
document.getElementById('controlPCBtn').onclick = () => { control='pc'; alert('تم اختيار تحكم الكمبيوتر'); };

// اختيار لون الكرة
document.querySelectorAll('.ballColorBtn').forEach(btn => {
  btn.onclick = () => {
    ballColor = btn.getAttribute('data-color');
    alert('تم اختيار اللون: ' + ballColor);
  };
});

// اختيار مستوى
document.querySelectorAll('.levelBtn').forEach(btn => {
  btn.onclick = () => {
    ballSpeed = Number(btn.getAttribute('data-speed'));
    levelMenu.classList.add('hidden');
    startGame();
  };
});

// ** اللعبة **
function startGame() {
  canvas.classList.remove('hidden');
  resizeCanvas();
  balls = [];
  score = 0;
  lives = 3;

  // إنشاء كرات أولية
  for(let i=0;i<5;i++){
    balls.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      r: 30,
      dx: (Math.random()-0.5)*ballSpeed,
      dy: (Math.random()-0.5)*ballSpeed,
    });
  }

  canvas.addEventListener(control==='mobile' ? 'touchstart' : 'mousedown', tapBall);

  requestAnimationFrame(gameLoop);
}

// الضرب على الكرة
function tapBall(e){
  let rect = canvas.getBoundingClientRect();
  let x = control==='mobile' ? e.touches[0].clientX - rect.left : e.clientX - rect.left;
  let y = control==='mobile' ? e.touches[0].clientY - rect.top : e.clientY - rect.top;

  balls.forEach((b,i)=>{
    let dist = Math.hypot(b.x-x,b.y-y);
    if(dist<b.r){
      balls.splice(i,1);
      score++;
      balls.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r:30,
        dx: (Math.random()-0.5)*ballSpeed,
        dy: (Math.random()-0.5)*ballSpeed,
      });
    }
  });
}

// تحديث وعرض الكرات
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // الكرات
  balls.forEach(b=>{
    b.x+=b.dx; b.y+=b.dy;
    if(b.x<b.r||b.x>canvas.width-b.r) b.dx*=-1;
    if(b.y<b.r||b.y>canvas.height-b.r) b.dy*=-1;
    ctx.fillStyle=ballColor;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  });

  // عرض النتيجة
  ctx.fillStyle='white';
  ctx.font='20px Arial';
  ctx.fillText('Score: '+score+' | Lives: '+lives, 10, 30);

  requestAnimationFrame(gameLoop);
}
</script>

</body>
</html>
