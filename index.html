<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Legendary Falling Balls Game</title>
<style>
html, body {
    margin:0; padding:0; height:100%; width:100%; overflow:hidden;
}
body { text-align:center; background:#87CEEB; font-family:Arial; }
canvas { background:white; display:block; margin:0 auto; touch-action: none; }
button { font-size:4vw; padding:1vw 2vw; margin:1vw; cursor:pointer; }
#startScreen, #gameOverScreen {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); color:white; display:flex; flex-direction:column;
    justify-content:center; align-items:center; font-size:6vw; z-index:10;
}
#scoreBox { font-size:4vw; background:white; padding:1vw; border:2px solid black; }
#shop { background:white; border:2px solid black; padding:1vw; font-size:4vw; }
</style>
</head>
<body>

<div id="startScreen">
    <div>üî• LEGENDARY MODE üî•</div>
    <button class="levelBtn" data-level="easy">Easy</button>
    <button class="levelBtn" data-level="normal">Normal</button>
    <button class="levelBtn" data-level="hard">Hard</button>
</div>

<div id="gameOverScreen" style="display:none;">
    <div>Game Over</div>
    <div id="finalScore"></div>
    <div id="highScoreDisplay"></div>
    <button id="restartBtn">Restart</button>
</div>

<div id="scoreBox">
Score: <span id="score">0</span> |
Coins: <span id="coins">0</span> |
Lives: <span id="lives">3</span> |
Level: <span id="level">1</span> |
Speed: <span id="speed">0</span> |
High Score: <span id="highScore">0</span>
</div>

<button id="pauseBtn">‚è∏ ÿ•ŸäŸÇÿßŸÅ</button>
<button id="turboBtn">üî• Turbo Mode</button>
<button id="extraBtn">‚ú® Extra</button>

<div id="shop">
<h3>üõí Shop</h3>
<button id="buySlow35">üê¢ Slow Time (35 Coins)</button>
<button id="firePower">üî• Fire Strike (50 Coins)</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ====== ÿßÿ¨ÿπŸÑ ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÉÿßŸÖŸÑÿ© ======
function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ================= VARS =================
let balls = [], score=0, coins=0, level=1;
let lives=3, gameRunning=false, isPaused=false, turbo=false;
let hits=0, highScore = localStorage.getItem("legendHighScore") || 0;
document.getElementById("highScore").textContent = highScore;
let fireUsed = false;

// ================= SOUNDS =================
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq,duration=0.1){ const osc=audioCtx.createOscillator(); const gain=audioCtx.createGain();
osc.connect(gain); gain.connect(audioCtx.destination); osc.type="square"; osc.frequency.value=freq;
gain.gain.value=0.2; osc.start(); osc.stop(audioCtx.currentTime+duration);}
function soundClick(){ playSound(700,0.05);}
function soundButton(){ playSound(300,0.1);}
function soundBoom(){ playSound(60,0.5);}

// ================= BALLS =================
function randomColor(){ let c=["red","green","blue","yellow","purple","orange"]; return c[Math.floor(Math.random()*c.length)];}
function createBall(explosive=false){ 
    return {
        x: Math.random()*(canvas.width-40)+20, 
        y: Math.random()*-canvas.height/2,
        r: Math.min(canvas.width, canvas.height)/30,
        speed: 3, color: explosive ? "black":randomColor(),
        explosive, flash:false, dx: Math.random()*2-1
    };
}
function initBalls(){ 
    balls=[]; 
    for(let i=0;i<3;i++) balls.push(createBall()); 
    balls.push(createBall(true));
}

// ====== FLASH EXPLOSIVE =====
setInterval(()=>{ balls.forEach(b=>{ if(b.explosive){ b.flash=!b.flash; b.color=b.flash?"red":"black"; } }); },1000);

// ====== DRAW =====
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    balls.forEach(b=>{
        ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fillStyle=b.color; ctx.fill();
    });
}

// ====== UPDATE =====
function update(){
    if(!gameRunning || isPaused) return;
    let maxSpeed=0;
    balls.forEach(b=>{
        b.y += b.speed; b.x += b.dx*1.5;
        if(b.speed>maxSpeed) maxSpeed=b.speed;
        if(b.x-b.r<0||b.x+b.r>canvas.width) b.dx*=-1;
        if(b.y-b.r>canvas.height){
            if(!b.explosive){ score--; document.getElementById("score").textContent=score; }
            b.y=Math.random()*-canvas.height/2; 
            b.x=Math.random()*(canvas.width-40)+20;
        }
    });
    document.getElementById("speed").textContent = maxSpeed.toFixed(1);
    draw(); requestAnimationFrame(update);
}

// ====== CLICK / TOUCH =====
function handleClick(x, y){
    if(!gameRunning || isPaused) return;
    balls.forEach(b=>{
        let dx=x-b.x, dy=y-b.y;
        if(dx*dx+dy*dy<=b.r*b.r){
            if(b.explosive){
                soundBoom(); lives--; if(lives<0) lives=0;
                document.getElementById("lives").textContent=lives;
                if(lives<=0) gameOver();
            } else {
                soundClick(); score++; coins++; hits++;
                document.getElementById("score").textContent=score;
                document.getElementById("coins").textContent=coins;
                if(hits>=13 && lives<3){ hits=0; lives++; document.getElementById("lives").textContent=lives; alert("‚ù§Ô∏è Extra Life!");}
                b.y=Math.random()*-canvas.height/2; 
                b.x=Math.random()*(canvas.width-40)+20;
            }
        }
    });
}

canvas.onclick = e=>{ 
    const rect = canvas.getBoundingClientRect();
    handleClick(e.clientX - rect.left, e.clientY - rect.top);
};
canvas.addEventListener('touchstart', e=>{
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const touch = e.touches[0];
    handleClick(touch.clientX - rect.left, touch.clientY - rect.top);
});

// ====== LEVEL SELECT =====
document.querySelectorAll(".levelBtn").forEach(btn=>{
    btn.onclick=()=>{
        soundButton();
        fireUsed = false;
        score=0; coins=0; level=1; lives=3; hits=0;
        document.getElementById("score").textContent=0;
        document.getElementById("coins").textContent=0;
        document.getElementById("level").textContent=1;
        document.getElementById("lives").textContent=3;
        initBalls();
        document.getElementById("startScreen").style.display="none";
        gameRunning=true; update();
    };
});

// ====== GAME OVER =====
function gameOver(){
    gameRunning=false;
    document.getElementById("finalScore").textContent="Score: "+score;
    if(score>highScore){ highScore=score; localStorage.setItem("legendHighScore",highScore);}
    document.getElementById("highScoreDisplay").textContent="High Score: "+highScore;
    document.getElementById("gameOverScreen").style.display="flex";
}
document.getElementById("restartBtn").onclick=()=>{ document.getElementById("gameOverScreen").style.display="none"; document.getElementById("startScreen").style.display="flex";}

// ====== PAUSE =====
document.getElementById("pauseBtn").onclick = togglePause;
document.addEventListener("keydown",e=>{ if(e.key==="Escape"){ togglePause(); }});
function togglePause(){ isPaused=!isPaused; document.getElementById("pauseBtn").textContent=isPaused?"‚ñ∂ ÿ™ÿ¥ÿ∫ŸäŸÑ":"‚è∏ ÿ•ŸäŸÇÿßŸÅ"; if(!isPaused) update();}

// ====== EXTRA BUTTON =====
document.getElementById("extraBtn").onclick=()=>{
    balls.forEach(b=>{ if(!b.explosive) b.color=randomColor(); });
    alert("‚ú® Extra Ball Colors Activated!");
};

// ====== TURBO MODE =====
setInterval(()=>{
    if(gameRunning){
        balls.forEach(b=> b.speed+=5);
        setTimeout(()=>{ balls.forEach(b=> b.speed-=5); },2000);
    }
},30000);

// ====== SLOW TIME BUTTON 35 coins =====
document.getElementById("buySlow35").onclick=()=>{
    if(coins>=35){
        coins-=35; document.getElementById("coins").textContent=coins;
        balls.forEach(b=> b.speed=1);
        setTimeout(()=>{ balls.forEach(b=> b.speed=3); },3000);
    } else alert("Not enough coins!");
};

// ====== FIRE STRIKE 50 coins =====
document.getElementById("firePower").onclick = ()=>{
    if(fireUsed){ alert("üî• Fire Strike already used!"); return; }
    if(coins>=50){
        coins-=50; document.getElementById("coins").textContent=coins;
        fireUsed = true;
        let fireDuration = 5000;
        let fireInterval = setInterval(()=>{
            balls.forEach(b=>{
                if(!b.explosive){
                    score++; coins++;
                    document.getElementById("score").textContent=score;
                    document.getElementById("coins").textContent=coins;
                    b.y=Math.random()*-canvas.height/2; 
                    b.x=Math.random()*(canvas.width-40)+20;
                }
            });
        },100);
        setTimeout(()=> clearInterval(fireInterval), fireDuration);
        alert("üî• Fire Strike Activated for 5s!");
    } else alert("Not enough coins!");
};

update();
</script>
</body>
</html>
