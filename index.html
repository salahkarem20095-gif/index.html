<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Legendary Falling Balls Game</title>
<style>
body { margin:0; padding:0; font-family:Arial; background:#87CEEB; text-align:center; }
canvas { display:block; margin:0; border:3px solid black; }
/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
#startScreen, #gameOverScreen, #settingsScreen {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); color:white; display:flex;
    flex-direction:column; justify-content:center; align-items:center;
    font-size:30px; z-index:10;
}
.hidden { display:none; }
button { font-size:18px; padding:8px 15px; margin:3px; cursor:pointer; }
#scoreBox { font-size:20px; background:white; padding:5px; border:2px solid black; }
#shop { background:white; border:2px solid black; padding:5px; font-size:18px; }
</style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
<div id="startScreen">
    <div>ğŸ”¥ LEGENDARY MODE ğŸ”¥</div>
    <button id="startBtn">Ø§Ø¨Ø¯Ø£</button>
    <button id="settingsBtn">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settingsScreen" class="hidden">
    <div>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
    <button id="mouseControlBtn">ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø§ÙˆØ³</button>
    <button id="touchControlBtn">ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³</button>
    <button id="backBtn">Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="gameOverScreen" class="hidden">
    <div>Game Over</div>
    <div id="finalScore"></div>
    <div id="highScoreDisplay"></div>
    <button id="restartBtn">Restart</button>
</div>

<div id="scoreBox">
Score: <span id="score">0</span> |
Coins: <span id="coins">0</span> |
Lives: <span id="lives">3</span> |
Level: <span id="level">1</span> |
Speed: <span id="speed">0</span> |
High Score: <span id="highScore">0</span>
</div>

<button id="pauseBtn">â¸ Ø¥ÙŠÙ‚Ø§Ù</button>
<button id="turboBtn">ğŸ”¥ Turbo Mode</button>
<button id="extraBtn">âœ¨ Extra</button>

<div id="shop">
<h3>ğŸ›’ Shop</h3>
<button id="buySlow35">ğŸ¢ Slow Time (35 Coins)</button>
<button id="firePower">ğŸ”¥ Fire Strike (50 Coins)</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ================= VARS =================
let balls = [], score=0, coins=0, level=1;
let lives=3, gameRunning=false, isPaused=false, turbo=false;
let hits=0, highScore = localStorage.getItem("legendHighScore") || 0;
document.getElementById("highScore").textContent = highScore;
let fireUsed = false;

// Ø§Ù„ØªØ­ÙƒÙ…: 'mouse' Ø£Ùˆ 'touch'
let controlMode = 'touch';

// ================= Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ =================
function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ================= Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© =================
document.getElementById("startBtn").onclick = ()=>{
    document.getElementById("startScreen").classList.add("hidden");
    startGame();
};
document.getElementById("settingsBtn").onclick = ()=>{
    document.getElementById("startScreen").classList.add("hidden");
    document.getElementById("settingsScreen").classList.remove("hidden");
};
document.getElementById("backBtn").onclick = ()=>{
    document.getElementById("settingsScreen").classList.add("hidden");
    document.getElementById("startScreen").classList.remove("hidden");
};
document.getElementById("mouseControlBtn").onclick = ()=>{ controlMode='mouse'; alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø§ÙˆØ³"); };
document.getElementById("touchControlBtn").onclick = ()=>{ controlMode='touch'; alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³"); };

// ================= TOUCH EVENTS =================
function handleClick(x,y){
    balls.forEach(b=>{
        let dx=x-b.x, dy=y-b.y;
        if(dx*dx+dy*dy <= b.r*b.r){
            if(b.explosive){
                lives--; if(lives<0) lives=0;
                document.getElementById("lives").textContent=lives;
                if(lives<=0) gameOver();
            } else {
                score++; coins++; hits++;
                document.getElementById("score").textContent=score;
                document.getElementById("coins").textContent=coins;
                b.y=Math.random()*-200; b.x=Math.random()* (canvas.width-40)+20;
            }
        }
    });
}
canvas.addEventListener('mousedown', e=>{
    if(controlMode==='mouse') handleClick(e.clientX, e.clientY);
});
canvas.addEventListener('touchstart', e=>{
    if(controlMode==='touch'){
        e.preventDefault();
        const touch = e.touches[0];
        handleClick(touch.clientX, touch.clientY);
    }
});

// ================= Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù =================
// ... Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªÙ„ØµÙ‚ ÙƒÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙˆÙ‚ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø­Ø°ÙØŒ ÙÙ‚Ø· ØªØºÙŠÙŠØ±Ù†Ø§ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ ÙˆØ§Ù„Ù„Ù…Ø³ ÙˆØ´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª

</script>
</body>
</html>
